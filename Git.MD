# `git rebase` æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Git å‘½ä»¤ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ ¸å¿ƒä½œç”¨

## 1. **åˆå¹¶æäº¤å†å²ï¼ˆä¸»è¦ç”¨é€”ï¼‰**

å°†å½“å‰åˆ†æ”¯çš„æäº¤â€œç§»åŠ¨â€åˆ°å¦ä¸€ä¸ªåˆ†æ”¯çš„æœ€æ–°æäº¤ä¹‹åï¼Œä½¿å†å²è®°å½•**çº¿æ€§åŒ–**ã€‚

```bash
# å½“å‰åœ¨ feature åˆ†æ”¯
# å°† feature åˆ†æ”¯åŸºäº main åˆ†æ”¯çš„æœ€æ–°æäº¤è¿›è¡Œå˜åŸº
git rebase main

# æˆ–è€…æ›´æ˜ç¡®çš„å†™æ³•
git checkout feature
git rebase main
```

**å˜åŸºå‰ï¼š**

```
main:    A---B---C
feature:        \---D---E
```

**å˜åŸºåï¼š**

```
main:    A---B---C
feature:                D'---E'  # æäº¤å“ˆå¸Œå˜äº†ï¼Œä½†å†…å®¹ç›¸åŒ
```

## 2. **äº¤äº’å¼å˜åŸºï¼ˆæ•´ç†æäº¤ï¼‰**

```bash
# ä¿®æ”¹æœ€è¿‘ 3 æ¬¡æäº¤
git rebase -i HEAD~3

# ä¼šæ‰“å¼€ç¼–è¾‘å™¨ï¼Œå¯ä»¥é€‰æ‹©æ“ä½œï¼š
# pick - ä¿ç•™æäº¤
# reword - ä¿®æ”¹æäº¤ä¿¡æ¯
# edit - ä¿®æ”¹æäº¤å†…å®¹
# squash - åˆå¹¶åˆ°å‰ä¸€ä¸ªæäº¤
# fixup - åˆå¹¶å¹¶ä¸¢å¼ƒæäº¤ä¿¡æ¯
# drop - åˆ é™¤æäº¤
```

## **ä¸»è¦ä½¿ç”¨åœºæ™¯**

### ğŸ“¦ **åœºæ™¯ 1ï¼šä¿æŒåˆ†æ”¯å¹²å‡€**

```bash
# å¼€å‘æ—¶å®šæœŸæ›´æ–°ä¸»åˆ†æ”¯ä»£ç 
git checkout feature
git fetch origin
git rebase origin/main
```

### âœ¨ **åœºæ™¯ 2ï¼šæ•´ç†æœ¬åœ°æäº¤**

```bash
# å°†å¤šä¸ªå°æäº¤åˆå¹¶æˆä¸€ä¸ªæ¸…æ™°çš„æäº¤
git rebase -i HEAD~5
# ç„¶åé€‰æ‹© squash æˆ– fixup
```

### ğŸ”€ **åœºæ™¯ 3ï¼šè§£å†³åˆ†æ”¯åˆ†å‰**

```bash
# æ›¿ä»£ mergeï¼Œé¿å…é¢å¤–çš„åˆå¹¶æäº¤
git rebase main
```

## **âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**

### **é»„é‡‘è§„åˆ™ï¼š**

**ä¸è¦å¯¹å·²æ¨é€åˆ°è¿œç¨‹ä¸”è¢«ä»–äººä½¿ç”¨çš„åˆ†æ”¯è¿›è¡Œå˜åŸºï¼**

```bash
# âœ… å¯ä»¥åšçš„ï¼š
# - æ•´ç†æœ¬åœ°æœªæ¨é€çš„æäº¤
# - ä¸ªäººåˆ†æ”¯çš„æ•´ç†

# âŒ ä¸è¦åšçš„ï¼š
# - å˜åŸºå…±äº«åˆ†æ”¯ï¼ˆå¦‚ main/developï¼‰
# - å˜åŸºå·²è¢«ä»–äººæ‹‰å–çš„åˆ†æ”¯
```

### **rebase vs merge å¯¹æ¯”**

| ç‰¹æ€§ | `git rebase` | `git merge` |
|------|-------------|------------|
| å†å²è®°å½• | **çº¿æ€§ã€æ•´æ´** | æœ‰åˆå¹¶æäº¤ã€æ˜¾ç¤ºåˆ†æ”¯ç»“æ„ |
| æäº¤å“ˆå¸Œ | **ä¼šæ”¹å˜** | ä¿ç•™åŸå“ˆå¸Œ |
| å®‰å…¨æ€§ | é£é™©è¾ƒé«˜ï¼ˆé‡å†™å†å²ï¼‰ | å®‰å…¨ï¼Œä¸æ”¹å˜å†å² |
| ä½¿ç”¨åœºæ™¯ | æ•´ç†æäº¤ã€ä¿æŒçº¿æ€§ | åˆå¹¶ç‰¹æ€§åˆ†æ”¯ã€ä¿ç•™å†å² |

## **å®ç”¨å·¥ä½œæµç¨‹**

```bash
# å¸¸è§å¼€å‘æµç¨‹
git checkout -b feature-branch
# åšä¸€äº›æäº¤...

# æ›´æ–°ä¸»åˆ†æ”¯ä»£ç 
git fetch origin
git rebase origin/main

# è§£å†³å¯èƒ½çš„å†²çª
git add .
git rebase --continue

# å®Œæˆåæ¨é€ï¼ˆé¦–æ¬¡æ¨é€ï¼‰
git push origin feature-branch

# å¦‚æœå·²ç»æ¨é€è¿‡ï¼Œéœ€è¦å¼ºåˆ¶æ¨é€ï¼ˆæ…ç”¨ï¼ï¼‰
git push --force-with-lease  # æ¯” --force æ›´å®‰å…¨
```

## åœ¨ rebase è¿‡ç¨‹ä¸­å›é€€ï¼ˆrebase è¿˜æœªå®Œæˆï¼‰

``` bash
# å¦‚æœ rebase é‡åˆ°å†²çªæ­£åœ¨è§£å†³ä¸­
git rebase --abort      # å®Œå…¨ä¸­æ­¢ rebaseï¼Œå›åˆ° rebase å‰çš„çŠ¶æ€
```

## rebase å®Œæˆåå›é€€åˆ°åŸå§‹çŠ¶æ€

### æ–¹æ³•Aï¼šä½¿ç”¨ reflogï¼ˆæ¨èï¼Œæœ€å®‰å…¨ï¼‰

``` bash
# 1. æŸ¥çœ‹å†å²æ“ä½œè®°å½•
git reflog

# è¾“å‡ºç¤ºä¾‹ï¼š
# b1d3f2c (HEAD -> main) HEAD@{0}: rebase finished: returning to refs/heads/main
# b1d3f2c (HEAD -> main) HEAD@{1}: rebase: feat: add new feature
# 2a4b6c8 HEAD@{2}: rebase: start onto refs/heads/origin/main
# 8e9d0f4 HEAD@{3}: checkout: moving from main to 8e9d0f4
# 9a8b7c6 HEAD@{4}: commit: original commit before rebase

# 2. æ‰¾åˆ° rebase å¼€å§‹å‰çš„æäº¤ï¼ˆå¦‚ HEAD@{4}ï¼‰
git reset --hard HEAD@{4}  # å›é€€åˆ°æŒ‡å®šçš„ reflog ä½ç½®
```

### æ–¹æ³•Bï¼šå¦‚æœçŸ¥é“åŸå§‹åˆ†æ”¯å

``` bash
# å‡è®¾ rebase å‰æœ‰ä¸ªå¤‡ä»½åˆ†æ”¯æˆ– tag
git reset --hard origin/main     # å›é€€åˆ°è¿œç¨‹åˆ†æ”¯çŠ¶æ€
git reset --hard backup-branch   # å›é€€åˆ°å¤‡ä»½åˆ†æ”¯
```

## 4. Git å¸¸ç”¨æ“ä½œ

### 4.1 Rebase ä¸æäº¤æ•´ç†

```bash
git rebase -i <commit-id>
git config --global core.editor vim
```

> ä½¿ç”¨ `vim` è¿›è¡Œ commit åˆå¹¶ã€æ•´ç†å†å²

---

### 4.2 åˆ†æ”¯ç®¡ç†

```bash
git checkout feature/navigation
git merge feature/lyl/locomotion
```

### 4.3 å¼ºåˆ¶æ¨é€ï¼ˆå®‰å…¨ï¼‰

```bash
git push origin feature/lyl/gripper --force-with-lease
```

---

## **æœ€ä½³å®è·µå»ºè®®**

1. **ä¸ªäººåˆ†æ”¯**ï¼šè‡ªç”±ä½¿ç”¨ rebase æ•´ç†æäº¤
2. **å…±äº«åˆ†æ”¯**ï¼šä½¿ç”¨ merge ä¿ç•™å®Œæ•´å†å²
3. **æ¨é€å‰**ï¼šç¡®ä¿æœ¬åœ°åˆ†æ”¯æ•´æ´åå†æ¨é€
4. **å›¢é˜Ÿåä½œ**ï¼šæ˜ç¡®å›¢é˜Ÿçš„ rebase ç­–ç•¥

è®°ä½ï¼š**rebase æ˜¯é‡å†™å†å²**ï¼Œé€‚ç”¨äºè®©å†å²æ›´æ¸…æ™°ï¼Œä½†è¦è°¨æ…ä½¿ç”¨ä»¥é¿å…ç»™åä½œè€…å¸¦æ¥å›°æ‰°ã€‚
